// server.js - Serveur MCP Motopass dédié
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import express from 'express';
import sqlite3 from 'sqlite3';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __dirname = dirname(fileURLToPath(import.meta.url));
// Configuration complète des sites Motopass
const MOTOPASS_ECOSYSTEM = {
  'motopass-fr': {
    name: 'Motopass France',
    url: 'https://www.motopass.fr',
    wp_api: 'https://www.motopass.fr/wp-json/wp/v2',
    language: 'fr',
    market: 'france',
    currency: 'EUR',
    homepage_id: 1124
  },
  'motopass-es': {
    name: 'Portacredenciales España', 
    url: 'https://www.portacredenciales-motopass.es',
    wp_api: 'https://www.portacredenciales-motopass.es/wp-json/wp/v2',
    language: 'es',
    market: 'spain',
    currency: 'EUR',
    homepage_id: 3050
  },
  'motopass-be': {
    name: 'Motopass Belgique',
    url: 'https://www.motopass.be',
    wp_api: 'https://www.motopass.be/wp-json/wp/v2',
    language: 'fr',
    market: 'belgium',
    currency: 'EUR'
  }
};
// Serveur Express simple pour Railway
const app = express();
const PORT = process.env.PORT || 3000;

app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    service: 'Motopass MCP Server',
    timestamp: new Date().toISOString(),
    sites: Object.keys(MOTOPASS_ECOSYSTEM).length
  });
});

app.get('/', (req, res) => {
  res.json({
    name: 'Motopass MCP Server',
    version: '1.0.0',
    description: 'Serveur MCP dédié Motopass SEO',
    sites_supported: Object.keys(MOTOPASS_ECOSYSTEM)
  });
});

// Démarrer le serveur
app.listen(PORT, () => {
  console.log(`🌐 Serveur Motopass démarré sur le port ${PORT}`);
  console.log(`🏍️ Prêt pour l'optimisation SEO !`);
});